@{
    Layout = "Shared/_HeroLayout.cshtml";
}
@using YorkshireDigital.Web.Infrastructure.Helpers
@inherits Nancy.ViewEngines.Razor.NancyRazorViewBase<YorkshireDigital.Web.Admin.ViewModels.AdminEventViewModel>

<a href="/admin">Back to Admin</a>

<h2>Edit <span id="event-name">@Model.Title</span></h2>

<form method="POST" data-parsley-validate>
    @Html.Partial("_Event", Model)

    @Html.ValidationSummary()

    <input type="submit" class="btn btn--primary btn--full" value="Update" />
</form>
<br />
<input type="submit" class="btn btn--negative btn--full" id="delete-event" data-event-id="@Model.UniqueName" value="Delete" />
@section Scripts
{
    <script type="text/javascript">
        $(function () {
            $(document).on('click', '#delete-event', function (e) {
                e.preventDefault();
                if (confirm('Are you sure?')) {
                    var id = $(this).data('event-id');
                    $.ajax({
                        type: 'DELETE',
                        url: '/admin/event/' + id
                    }).done(function () {
                        window.location.href = '/admin';
                    });
                }
            });

            $(document).on('click', '.js-add-talk', function (e) {
                e.preventDefault();

                var $template = $('.js-talk-template').clone();
                $template.removeClass('js-talk-template');
                $template.removeClass('is-hidden');
                $template.addClass('js-talk-wrapper');

                var index = $('.js-talk-wrapper', '.js-talks-wrapper').length;

                $template.html($template.html().replace(/\[index\]/g, '['+index+']'));

                $('.js-talks-wrapper').append($template);
            });
            $(document).on('click', '.js-remove-talk', function (e) {
                e.preventDefault();
                if (confirm('Are you sure?')) {
                    $(this).closest('.js-talk-wrapper').remove();

                    $('.js-talk-wrapper', '.js-talks-wrapper').each(function(i) {
                        $(this).html($(this).html().replace(/\[\d+\]/g, '[' + i + ']'));
                    });
                }
            });

        });
    </script>
    <script type="text/javascript" src="/public/scripts/vendor/chosen.jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/public/scripts/vendor/chosen.min.css" />
    <script type="text/javascript">
        $(function() {
            $(".chosen-select").chosen({ disable_search_threshold: 10 });
        });
    </script>
    <style type="text/css">
        .js-talk-wrapper {
            width: 33%;
            display: inline-block;
        }
    </style>
}
