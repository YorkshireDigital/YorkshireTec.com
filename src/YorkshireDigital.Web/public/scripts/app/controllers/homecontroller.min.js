!function(){"use strict";function e(e,t,n,o,a,i,r){function s(){e.to_trusted=function(e){return t.trustAsHtml(e)},e.clndrNextMonth=function(){e.clndr.forward();var t=moment(e.clndr.month._d).date(1).add(1,"M").format("DD/MM/YYYY"),n=moment(e.clndr.month._d).date(1).add(2,"M").format("DD/MM/YYYY");e.loadEvents(t,n,function(t){e.addNewEvents(t)})},e.clndrPreviousMonth=function(){e.clndr.back();var t=moment(e.clndr.month._d).date(1).subtract(1,"M").format("DD/MM/YYYY"),n=moment(e.clndr.month._d).date(1).format("DD/MM/YYYY");e.loadEvents(t,n,function(t){e.addNewEvents(t)})},e.addNewEvents=function(t){for(var n=[],o=t.length-1;o>=0;o--){for(var a=!1,i=0;i<e.events.length;i++)t[o].uniqueName==e.events[i].uniqueName&&(a=!0);a===!1&&(n.push(t[o]),e.events.push(t[o]))}return e.populateFilters(n),e.clndr.addEvents(n),n},e.loadEvent=function(o){n.Events.get({eventId:o},function(n){e.activeEvent=n,e.activeEvent.startFormat=t.trustAsHtml(n.startFormat),r.path("/event/"+n.uniqueName,!1),$("body").addClass("no-scroll")})},e.closeEvent=function(){var t=e.activeEvent.uniqueName;e.activeEvent=null,r.path("/",!1),$("body").removeClass("no-scroll");var n=$("#"+t).position().top;$(window).scrollTop(n)},e.loadEvents=function(e,t,o){n.Calendar.query({from:e,to:t},o)},e.populateFilters=function(t){for(var n=e.interests||[],o=e.locations||[],a=t.length-1;a>=0;a--){for(var i=t[a].interests.length-1;i>=0;i--)-1===$.inArray(t[a].interests[i],n)&&n.push(t[a].interests[i]);-1===$.inArray(t[a].region,o)&&o.push(t[a].region)}e.interests=n,e.locations=o,e.search=e.search||{interests:"",location:""}},e.showFeedbackPanel=function(){$(".notification__title").fadeOut(),$(".feedback-panel").slideDown()},e.hideFeedbackPanel=function(){$(".notification__title").fadeIn(),$(".feedback-panel").slideUp()},e.showTrelloForm=function(){$("#raise-on-slack").slideUp(),$("#raise-on-trello").slideDown()},e.showSlackForm=function(){$("#raise-on-trello").slideUp(),$("#raise-on-slack").slideDown()},e.raiseOnSlack=function(t){$("#js-slack-feedback").empty();var n=!0;t.name||($("#js-slack-feedback").append($("<li />",{text:"Please provide your name"})),n=!1),t.contact||($("#js-slack-feedback").append($("<li />",{text:"Please provide contact details"})),n=!1),t.details||($("#js-slack-feedback").append($("<li />",{text:"Please provide details of the issue"})),n=!1),n&&(o.Raise.save(t),e.modal.hide(),$(".notification__title").after('<span class="notification__feedback">Thank you for your feedback '+t.name+". We'll be in touch soon.</span>"),$(".feedback-panel").slideUp(),setTimeout(function(){$(".notification__feedback").fadeOut(1e3),setTimeout(function(){$(".notification__title").fadeIn()},1e3)},2e3))},e.formatDay=function(e,t){return moment(e).format(t)}}s(),e.modal=a,e.title="homeController",i.eventName&&e.loadEvent(i.eventName);var l=moment().date(1).subtract(1,"M").format("DD/MM/YYYY"),d=moment().date(1).add(2,"M").format("DD/MM/YYYY");config.isBeta&&(e.beta=!0,e.reportedIssue={site:document.URL}),e.loadEvents(l,d,function(t){e.events=t,e.populateFilters(t),$(".clndr-grid").removeClass("loading-item"),$(".loading-item__overlay").hide()})}window.app.controller("homeController",["$scope","$sce","calendarService","feedbackService","modal","$routeParams","$location",e])}();